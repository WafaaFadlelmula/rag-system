services:
  - type: web
    name: ecoice-rag-api
    runtime: python
    region: frankfurt          # same region as Qdrant Cloud cluster (europe-west3)

    buildCommand: pip install -r requirements-backend.txt

    startCommand: PYTHONPATH=src python scripts/serve.py

    healthCheckPath: /api/v1/health

    envVars:
      - key: PYTHONPATH
        value: src

      # chunks.json is NOT in the repo (company data).
      # Upload it via: Render dashboard → Environment → Secret Files
      #   Mount path: /etc/secrets/chunks.json
      #   Contents:   paste the contents of data/chunks/chunks.json
      - key: CHUNKS_DATA_PATH
        value: /etc/secrets/chunks.json

      # Set these in Render dashboard → Environment → Environment Variables
      - key: OPENAI_API_KEY
        sync: false

      - key: QDRANT_URL
        sync: false

      - key: QDRANT_API_KEY
        sync: false

      # Cohere Rerank API (free tier: 1,000 calls/month)
      # Get key from: dashboard.cohere.com → API Keys
      - key: COHERE_API_KEY
        sync: false

      # Bearer token — protects /query and /monitor endpoints
      # Generate: python -c "import secrets; print(secrets.token_hex(32))"
      - key: API_BEARER_TOKEN
        sync: false
